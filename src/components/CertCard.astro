---
import { certifications, certGroups } from '@/data/education';
---

<div class="glass-card p-6 md:p-8 col-span-full overflow-hidden">
  <h3 class="text-text-muted text-xs font-semibold uppercase tracking-wider mb-5">Certifications</h3>

  <!-- Group filter tabs -->
  <div class="flex flex-wrap gap-2 mb-6" id="cert-tabs">
    <button data-group="all"
      class="cert-tab px-3 py-1.5 text-xs font-medium rounded-lg border transition-all duration-200 bg-accent/15 text-accent border-accent/30">
      All <span class="ml-1 opacity-60">{certifications.length}</span>
    </button>
    {certGroups.map(g => (
      <button data-group={g.key}
        class="cert-tab px-3 py-1.5 text-xs font-medium rounded-lg border transition-all duration-200 bg-surface-card text-text-muted border-border-glass hover:border-accent/30 hover:text-accent">
        {g.label}
        <span class="ml-1 opacity-60">{certifications.filter(c => c.groups.includes(g.key)).length}</span>
      </button>
    ))}
  </div>

  <!-- Certification cards -->
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-3" id="cert-grid">
    {certifications.map(cert => (
      <div data-cert-groups={cert.groups.join(',')}
        class="cert-item p-4 rounded-2xl bg-surface-card border border-border-glass hover:border-accent/30 hover:bg-surface-card-hover transition-all duration-300 group flex flex-col">
        <div class="flex flex-wrap gap-1.5 mb-3">
          {cert.groups.map(g => (
            <span class="text-[10px] px-1.5 py-0.5 rounded-md bg-accent/10 text-accent font-medium">{g}</span>
          ))}
        </div>
        <div class="text-text-primary text-sm font-semibold group-hover:text-accent transition-colors leading-snug flex-1">
          {cert.url ? (
            <a href={cert.url} target="_blank" rel="noopener noreferrer" class="hover:underline inline-flex items-center gap-1">
              {cert.name}
              <svg class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
          ) : (
            <span class="text-text-primary/70">{cert.name}</span>
          )}
        </div>
        <div class="text-text-muted text-xs mt-2">{cert.issuer}</div>
        <div class="text-accent/70 text-xs font-mono mt-1">{cert.year}</div>
      </div>
    ))}
  </div>

  <!-- Hint -->
  <p class="text-text-muted/50 text-xs mt-5 text-center italic">Click on a certification name to view the credential</p>
</div>

<script>
  const tabs = document.querySelectorAll<HTMLButtonElement>('.cert-tab');
  const items = document.querySelectorAll<HTMLElement>('.cert-item');

  const activeClasses = ['bg-accent/15', 'text-accent', 'border-accent/30'];
  const inactiveClasses = ['bg-surface-card', 'text-text-muted', 'border-border-glass'];

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const group = tab.dataset.group;

      // Update tab styles
      tabs.forEach(t => {
        t.classList.remove(...activeClasses);
        t.classList.add(...inactiveClasses);
      });
      tab.classList.remove(...inactiveClasses);
      tab.classList.add(...activeClasses);

      // Filter items â€” match if any of the cert's groups matches
      items.forEach(item => {
        const certGroups = (item.dataset.certGroups || '').split(',');
        const match = group === 'all' || certGroups.includes(group!);
        if (match) {
          item.style.display = '';
          item.style.opacity = '0';
          item.style.transform = 'scale(0.95)';
          requestAnimationFrame(() => {
            item.style.transition = 'opacity 0.25s ease, transform 0.25s ease';
            item.style.opacity = '1';
            item.style.transform = 'scale(1)';
          });
        } else {
          item.style.opacity = '0';
          item.style.transform = 'scale(0.95)';
          setTimeout(() => { item.style.display = 'none'; }, 200);
        }
      });
    });
  });
</script>
